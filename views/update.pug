//- Form page for adding a new zip code record
extends layout

block content
  header.border-b.border-neutral-800.py-6(class="dark:border-neutral-200")
    .max-w-5xl.mx-auto.px-6.flex.justify-between.items-center
      div
        h1.font-display.text-2xl.font-bold.tracking-tight
          a.transition-opacity(class="hover:opacity-80" href="/") GROUND TRUTH
        p.text-sm.mt-1.text-neutral-400 Housing ownership by zip code

      //- Theme toggle
      button.transition-colors.text-sm.uppercase.tracking-wider.text-neutral-400.bg-transparent.border-none.cursor-pointer(class="hover:text-neutral-50 focus-visible:outline focus-visible:outline-2px focus-visible:outline-neutral-50 focus-visible:outline-offset-2px" onclick="toggleTheme()" id="theme-toggle" aria-label="Toggle theme" type="button")
        span#theme-icon(aria-hidden="true") ◐
        |  Theme
  
  main#main-content.max-w-5xl.mx-auto.px-6.py-12
    
    .mb-8
      a.text-sm.transition-colors.inline-flex.items-center.gap-2.text-neutral-400(class="hover:text-neutral-50 focus-visible:outline focus-visible:outline-2px focus-visible:outline-neutral-50 focus-visible:outline-offset-2px" href="/")
        span(aria-hidden="true") ←
        span Return to the homepage

    //- Page title
    .mb-12
      h2.font-display.text-3xl.font-bold.tracking-tight.mb-2 Add Zip Code
      p.text-neutral-400 Enter housing data for a new zip code.
    
    if error
      .bg-red-500.bg-opacity-10.border.border-red-500.p-4.mb-8.rounded-sm(role="alert" aria-live="assertive")
        p.text-red-400.text-sm= error
    
    form.max-w-md(method="POST" action="/update-cobj" data-enhanced)

      //- Zip code input
      .mb-6
        label.block.text-xs.uppercase.tracking-wider.mb-2.text-neutral-400(for="name") Zip Code
        input.w-full.border.border-neutral-800.px-4.py-3.transition-colors.tabular-nums.bg-neutral-900.text-neutral-50.rounded-sm(
          class="placeholder-neutral-600 focus:outline-none focus:border-neutral-600"
          type="text"
          inputmode="numeric"
          id="name"
          name="name"
          placeholder="e.g., 84101"
          required
          pattern="[0-9]{5}"
          minlength="5"
          maxlength="5"
          autocomplete="postal-code"
          value=(formData && formData.name ? formData.name : '')
          aria-describedby="name-help"
          aria-required="true"
          aria-invalid="false"
        )
        p#name-help.text-xs.mt-2.text-neutral-600 Must be exactly 5 digits
      
      //- Homeownership rate input
      .mb-6
        label.block.text-xs.uppercase.tracking-wider.mb-2.text-neutral-400(for="homeownership_rate") Homeownership Rate
        .relative
          input.w-full.border.border-neutral-800.px-4.py-3.pr-12.transition-colors.tabular-nums.bg-neutral-900.text-neutral-50.rounded-sm(
            class="placeholder-neutral-600 focus:outline-none focus:border-neutral-600"
            type="number"
            inputmode="decimal"
            id="homeownership_rate"
            name="homeownership_rate"
            placeholder="e.g., 65.4"
            step="0.1"
            min="0"
            max="100"
            required
            value=(formData && formData.homeownership_rate ? formData.homeownership_rate : '')
            aria-describedby="rate-help"
            aria-required="true"
            aria-invalid="false"
          )
          span.absolute.right-4.text-neutral-600(class="top-1/2 -translate-y-1/2" aria-hidden="true") %
        p#rate-help.text-xs.mt-2.text-neutral-600 Must be between 0% and 100%
      
      //- Median home value input
      .mb-8
        label.block.text-xs.uppercase.tracking-wider.mb-2.text-neutral-400(for="median_home_age") Median Home Value
        .relative
          span.absolute.left-4.text-neutral-600(class="top-1/2 -translate-y-1/2" aria-hidden="true") $
          input.w-full.border.border-neutral-800.pl-8.pr-4.py-3.transition-colors.tabular-nums.bg-neutral-900.text-neutral-50.rounded-sm(
            class="placeholder-neutral-600 focus:outline-none focus:border-neutral-600"
            type="number"
            inputmode="numeric"
            id="median_home_age"
            name="median_home_age"
            placeholder="e.g., 425000"
            min="1000"
            step="1"
            required
            value=(formData && formData.median_home_age ? formData.median_home_age : '')
            aria-describedby="value-help"
            aria-required="true"
            aria-invalid="false"
          )
        p#value-help.text-xs.mt-2.text-neutral-600 Must be at least $1,000

      //- Associate contacts (optional)
      .mb-8
        label.block.text-xs.uppercase.tracking-wider.mb-3.text-neutral-400 Associate Contacts (Optional)

        if contacts && contacts.length > 0
          .space-y-2.max-h-64.overflow-y-auto.border.border-transparent.p-4.bg-neutral-900.rounded-sm
            each contact in contacts
              .flex.items-start
                input(
                  type="checkbox"
                  id=`contact-${contact.id}`
                  name="contactIds"
                  value=contact.id
                  class="mt-0.5 w-4 h-4 cursor-pointer accent-neutral-50"
                )
                label.ml-3.text-sm.cursor-pointer.text-neutral-50.transition-colors(
                  class="hover:text-neutral-200"
                  for=`contact-${contact.id}`
                )
                  = (contact.properties.firstname || '') + ' ' + (contact.properties.lastname || '')
                  if contact.properties.email
                    span.text-neutral-600.ml-2.text-xs= '(' + contact.properties.email + ')'

          p.text-xs.mt-3.text-neutral-600 Select contacts to associate with this zip code
        else
          p.text-sm.text-neutral-600.py-4 No contacts available. Create contacts in HubSpot to associate them.

      //- Form buttons
      .flex.gap-4
        button.px-6.py-3.font-medium.transition-colors.bg-neutral-50.text-neutral-950.rounded-sm(class="hover:bg-neutral-200 focus-visible:outline focus-visible:outline-2px focus-visible:outline-neutral-50 focus-visible:outline-offset-2px" type="submit" aria-label="Submit form to add zip code to database")
          | Add to database
        a.px-6.py-3.border.border-neutral-800.transition-colors.text-neutral-400.rounded-sm(class="hover:border-neutral-600 hover:text-neutral-50 focus-visible:outline focus-visible:outline-2px focus-visible:outline-neutral-50 focus-visible:outline-offset-2px" href="/" role="button" aria-label="Cancel and return to homepage")
          | Cancel

  script(src=isProduction ? "/js/form.min.js" : "/js/form.js")
